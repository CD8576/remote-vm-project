version: '3'

services:
  # Guacamole web client
  guacamole:
    image: guacamole/guacamole:latest
    container_name: guacamole
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - GUACD_HOSTNAME=guacd
      - GUACD_PORT=4822
    depends_on:
      - guacd
      - mysql

  # Guacamole proxy daemon
  guacd:
    image: guacamole/guacd:latest
    container_name: guacd
    restart: unless-stopped
    depends_on:
      - mysql

  # MySQL database for Guacamole
  mysql:
    image: mysql:8.0
    container_name: mysql
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=your_guac_password
      - MYSQL_DATABASE=guacamole_db
      - MYSQL_USER=guac_user
      - MYSQL_PASSWORD=guac_password
    volumes:
      - ./data/mysql:/var/lib/mysql

  # Your Node.js web server (uses the `nodejs` subdirectory)
  nodejs:
    build: ./nodejs
    container_name: nodejs-web
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - ./nodejs:/usr/src/app
    depends_on:
      - guacamole

networks:
  default:
    driver: bridge
